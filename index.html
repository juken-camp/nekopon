<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no, shrink-to-fit=no">
    <title>üê± NEKOPON üê±</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Fredoka+One:wght@400&display=swap');
        @import url('https://fonts.googleapis.com/css2?family=M+PLUS+Rounded+1c:wght@400;700&display=swap');

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            width: 100%;
            height: 100%;
            position: fixed;
            overflow: hidden;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
            -webkit-touch-callout: none;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: 'M PLUS Rounded 1c', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #faf8ef 0%, #f2e8d5 100%);
            color: #776e65;
            font-weight: bold;
            width: 100%;
            height: 100%;
            position: fixed;
            overflow: hidden;
            cursor: pointer;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
            -webkit-touch-callout: none;
            -webkit-tap-highlight-color: transparent;
            -webkit-text-size-adjust: none;
            -moz-text-size-adjust: none;
            -ms-text-size-adjust: none;
            text-size-adjust: none;
        }

        .field {
            position: absolute;
            top: 120px;
            left: 20px;
            right: 20px;
            bottom: 20px;
            border-radius: 15px;
            padding: 15px;
            overflow: hidden;
            pointer-events: none;
            background: rgba(255,255,255,0.1);
            backdrop-filter: blur(5px);
            box-shadow: inset 0 0 20px rgba(255,255,255,0.2);
        }

        .title {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            font-family: 'Fredoka One', cursive;
            font-size: 40px;
            color: #776e65;
            text-shadow: 3px 3px 6px rgba(0,0,0,0.15);
            z-index: 1001;
            letter-spacing: 2px;
            cursor: pointer;
            user-select: none;
            transition: transform 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            white-space: nowrap;
        }

        .title:hover {
            transform: translateX(-50%) scale(1.05);
        }

        .title.title-bounce {
            animation: title-bounce 1.2s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        }

        @keyframes title-bounce {
            0% { transform: translateX(-50%) scale(1) rotate(0deg); }
            15% { transform: translateX(-50%) scale(1.1) rotate(2deg); }
            30% { transform: translateX(-50%) scale(1.18) rotate(-1deg); }
            45% { transform: translateX(-50%) scale(1.25) rotate(1deg); }
            60% { transform: translateX(-50%) scale(1.15) rotate(-0.5deg); }
            75% { transform: translateX(-50%) scale(1.08) rotate(0.5deg); }
            85% { transform: translateX(-50%) scale(1.03) rotate(-0.2deg); }
            95% { transform: translateX(-50%) scale(1.01) rotate(0.1deg); }
            100% { transform: translateX(-50%) scale(1) rotate(0deg); }
        }

        .cat-icon {
            display: inline-block;
            cursor: pointer;
            transition: transform 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            font-size: 42px;
            margin: 0 8px;
        }

        .cat-icon:hover {
            transform: scale(1.2) rotate(15deg);
        }

        .cat-icon.bounce {
            animation: cat-bounce 0.8s ease-in-out;
        }

        /* „Çø„Ç§„Éà„É´Áå´„ÇÇÂÇæ„Åç„Å´ÂèçÂøú */
        .cat-icon.tilt-responsive {
            transition: transform 0.3s ease-out;
        }

        @keyframes cat-bounce {
            0%, 100% { transform: scale(1) rotate(0deg); }
            25% { transform: scale(1.4) rotate(15deg); }
            50% { transform: scale(1.6) rotate(-10deg); }
            75% { transform: scale(1.3) rotate(12deg); }
        }

        .header {
            position: absolute;
            top: 80px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 20px;
            align-items: center;
            z-index: 1000;
            background: rgba(255,255,255,0.25);
            padding: 8px 24px;
            border-radius: 25px;
            backdrop-filter: blur(12px);
            box-shadow: 0 6px 25px rgba(0,0,0,0.12);
        }

        .score-item {
            font-size: 18px;
            color: #776e65;
            display: flex;
            align-items: center;
            gap: 6px;
            font-family: 'M PLUS Rounded 1c', sans-serif;
            font-weight: 700;
            transition: all 0.3s ease;
        }

        .score-item.pulse {
            animation: score-pulse 0.6s ease-in-out;
        }

        @keyframes score-pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.2); filter: brightness(1.5); }
        }

        .cat {
            position: absolute;
            font-size: 50px;
            cursor: pointer;
            transition: transform 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            user-select: none;
            z-index: 100;
            transform-origin: center;
            pointer-events: auto;
            filter: drop-shadow(0 2px 8px rgba(0,0,0,0.2));
        }

        .cat:not(.dragging):not(.merging):not(.chain) {
            animation: live-breathe 4s ease-in-out infinite;
        }

        .cat:nth-child(3n+1):not(.dragging):not(.merging):not(.chain) {
            animation: live-pulse 3.5s ease-in-out infinite;
            animation-delay: 0.5s;
        }

        .cat:nth-child(3n+2):not(.dragging):not(.merging):not(.chain) {
            animation: live-wiggle 4.2s ease-in-out infinite;
            animation-delay: 1s;
        }

        @keyframes live-breathe {
            0%, 100% { transform: scale(1) rotate(0deg); }
            50% { transform: scale(1.08) rotate(2deg); }
        }

        @keyframes live-pulse {
            0%, 100% { transform: scale(1); filter: brightness(1); }
            50% { transform: scale(1.12); filter: brightness(1.2); }
        }

        @keyframes live-wiggle {
            0%, 100% { transform: scale(1) rotate(0deg) translateX(0); }
            25% { transform: scale(1.05) rotate(3deg) translateX(-2px); }
            75% { transform: scale(1.05) rotate(-3deg) translateX(2px); }
        }

        .cat:hover {
            transform: scale(1.25) !important;
            animation: none !important;
            z-index: 200;
        }

        .cat.dragging {
            transform: scale(1.4) rotate(10deg) !important;
            z-index: 1000;
            animation: none !important;
            filter: drop-shadow(0 8px 20px rgba(0,0,0,0.4));
            transition: none !important;
        }

        .cat.merging {
            animation: mega-merge 0.8s cubic-bezier(0.34, 1.56, 0.64, 1) !important;
            z-index: 500;
        }

        .cat.chain {
            animation: chain-reaction 1s ease-in-out !important;
            z-index: 600;
        }

        .cat.pop {
            animation: birth-pop 0.4s cubic-bezier(0.34, 1.56, 0.64, 1) !important;
        }

        @keyframes mega-merge {
            0% { transform: scale(1) rotate(0deg); filter: brightness(1); }
            30% { transform: scale(1.6) rotate(180deg); filter: brightness(2) hue-rotate(180deg); }
            60% { transform: scale(2.2) rotate(270deg); filter: brightness(3) hue-rotate(360deg); }
            100% { transform: scale(1) rotate(360deg); filter: brightness(1); }
        }

        @keyframes chain-reaction {
            0% { transform: scale(1); filter: brightness(1) saturate(1); }
            25% { transform: scale(1.8); filter: brightness(3) saturate(2) hue-rotate(90deg); }
            50% { transform: scale(2.4); filter: brightness(4) saturate(3) hue-rotate(180deg); }
            75% { transform: scale(1.6); filter: brightness(2) saturate(1.5) hue-rotate(270deg); }
            100% { transform: scale(1); filter: brightness(1) saturate(1) hue-rotate(360deg); }
        }

        @keyframes birth-pop {
            0% { transform: scale(0) rotate(0deg); opacity: 0; }
            60% { transform: scale(1.3) rotate(180deg); opacity: 0.9; }
            100% { transform: scale(1) rotate(360deg); opacity: 1; }
        }

        .floating-score {
            position: absolute;
            font-family: 'M PLUS Rounded 1c', sans-serif;
            font-size: 24px;
            font-weight: 700;
            color: #f59563;
            pointer-events: none;
            z-index: 800;
            text-shadow: 3px 3px 6px rgba(0,0,0,0.5);
            animation: float-up 2s ease-out forwards;
            white-space: nowrap;
        }

        .floating-score.chain {
            font-size: 32px;
            color: #ff6b6b;
            animation: float-chain 2.5s ease-out forwards;
        }

        .floating-score.mega {
            font-size: 40px;
            color: #ff1744;
            animation: float-mega 3s ease-out forwards;
        }

        @keyframes float-up {
            0% { opacity: 1; transform: translateY(0) scale(1); }
            100% { opacity: 0; transform: translateY(-100px) scale(1.5); }
        }

        @keyframes float-chain {
            0% { opacity: 1; transform: translateY(0) scale(1) rotate(0deg); }
            50% { opacity: 1; transform: translateY(-60px) scale(2) rotate(180deg); }
            100% { opacity: 0; transform: translateY(-150px) scale(3) rotate(360deg); }
        }

        @keyframes float-mega {
            0% { opacity: 1; transform: translateY(0) scale(1) rotate(0deg); }
            30% { opacity: 1; transform: translateY(-40px) scale(2.5) rotate(120deg); }
            60% { opacity: 1; transform: translateY(-100px) scale(4) rotate(240deg); }
            100% { opacity: 0; transform: translateY(-200px) scale(6) rotate(720deg); }
        }

        .msg {
            position: absolute;
            font-family: 'M PLUS Rounded 1c', sans-serif;
            font-size: 18px;
            font-weight: 700;
            color: #8f7a66;
            pointer-events: none;
            z-index: 700;
            animation: float 2.5s ease-out forwards;
            text-shadow: 2px 2px 4px rgba(255,255,255,0.8);
            white-space: nowrap;
        }

        @keyframes float {
            0% { opacity: 1; transform: translateY(0) scale(1); }
            100% { opacity: 0; transform: translateY(-80px) scale(1.3); }
        }

        .chain-text {
            position: absolute;
            font-family: 'Fredoka One', cursive;
            font-size: 56px;
            font-weight: bold;
            color: #ff6b6b;
            pointer-events: none;
            z-index: 900;
            text-shadow: 4px 4px 8px rgba(0,0,0,0.6);
            animation: chain-appear 3s ease-out forwards;
            white-space: nowrap;
        }

        @keyframes chain-appear {
            0% { opacity: 0; transform: scale(0) rotate(-360deg); }
            20% { opacity: 1; transform: scale(2) rotate(0deg); }
            80% { opacity: 1; transform: scale(1.5) rotate(10deg); }
            100% { opacity: 0; transform: scale(0.5) rotate(360deg); }
        }

        .particle {
            position: absolute;
            font-size: 24px;
            pointer-events: none;
            z-index: 400;
            animation: particle-burst 2s ease-out forwards;
        }

        @keyframes particle-burst {
            0% { opacity: 1; transform: scale(0) rotate(0deg); }
            20% { opacity: 1; transform: scale(1.5) rotate(180deg); }
            100% { opacity: 0; transform: scale(0.5) rotate(720deg) translateY(-100px); }
        }

        .fever-mode {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: radial-gradient(circle, rgba(255,215,0,0.1) 0%, rgba(255,69,0,0.1) 100%);
            pointer-events: none;
            z-index: 50;
            animation: fever-pulse 0.5s ease-in-out infinite alternate;
        }

        @keyframes fever-pulse {
            0% { opacity: 0; }
            100% { opacity: 1; }
        }

        .permission-popup {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 25px;
            border-radius: 20px;
            box-shadow: 0 15px 40px rgba(0,0,0,0.3);
            z-index: 2000;
            font-family: 'M PLUS Rounded 1c', sans-serif;
            text-align: center;
            max-width: 320px;
            line-height: 1.6;
        }

        .permission-popup h3 {
            font-size: 20px;
            margin-bottom: 12px;
            color: #776e65;
        }

        .permission-popup p {
            font-size: 15px;
            margin-bottom: 20px;
            color: #8f7a66;
        }

        .permission-popup button {
            background: linear-gradient(145deg, #8f7a66, #a68a76);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 25px;
            font-size: 15px;
            font-weight: 700;
            cursor: pointer;
            margin: 8px 6px;
            width: 120px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        .permission-popup button:hover {
            background: linear-gradient(145deg, #9f8a76, #b69a86);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.3);
        }

        /* „Çπ„Éû„ÉõÂØæÂøú */
        @media (max-width: 480px) {
            .title {
                font-size: 36px;
                top: 18px;
                letter-spacing: 1px;
            }

            .cat-icon {
                font-size: 38px;
                margin: 0 6px;
            }

            .header {
                top: 75px;
                gap: 15px;
                padding: 6px 20px;
            }

            .score-item {
                font-size: 16px;
                gap: 5px;
            }

            .field {
                top: 115px;
            }

            .cat {
                font-size: 40px;
            }

            .floating-score {
                font-size: 20px;
            }

            .chain-text {
                font-size: 42px;
            }

            .permission-popup {
                max-width: 300px;
                padding: 20px;
            }

            .permission-popup h3 {
                font-size: 18px;
            }

            .permission-popup p {
                font-size: 14px;
            }

            .permission-popup button {
                width: 110px;
                font-size: 14px;
            }
        }

        @media (max-width: 380px) {
            .title {
                font-size: 32px;
            }

            .cat-icon {
                font-size: 34px;
                margin: 0 4px;
            }

            .header {
                gap: 12px;
                padding: 5px 16px;
            }

            .score-item {
                font-size: 15px;
                gap: 4px;
            }

            .floating-score {
                font-size: 18px;
            }

            .chain-text {
                font-size: 36px;
            }

            .permission-popup {
                max-width: 280px;
            }

            .permission-popup button {
                width: 100px;
                font-size: 13px;
            }
        }
    </style>
</head>
<body>
    <div class="title" id="titleElement">
        <span class="cat-icon tilt-responsive" id="leftCat">üê±</span>NEKOPON<span class="cat-icon tilt-responsive" id="rightCat">üê±</span>
    </div>

    <div class="header">
        <div class="score-item" id="scoreItem">‚ú® <span id="score">0</span></div>
        <div class="score-item" id="chainItem">üî• <span id="chainDisplay">0</span></div>
        <div class="score-item" id="levelItem">üèÜ <span id="level">1</span></div>
    </div>

    <div class="field" id="field"></div>

    <script>
        class UltimateNekopon {
            constructor() {
                this.score = 0;
                this.level = 1;
                this.cats = [];
                this.catId = 0;
                this.chainCount = 0;
                this.maxChain = 0;
                this.feverMode = false;
                this.feverTimer = null;
                this.discovered = new Set();
                this.audioContext = null;

                // ÂÇæ„ÅçÊÑüÁü•Èñ¢ÈÄ£
                this.tiltEnabled = false;
                this.currentTilt = { gamma: 0, beta: 0 };
                this.lastTiltTime = 0;

                // „Çø„Ç§„Éà„É´„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥Âà∂Âæ°
                this.titleBouncing = false;

                // ÈÄ≤Âåñ„ÉÅ„Çß„Éº„É≥
                this.evolutionChain = [
                    'üò∫', 'üò∏', 'üòª', 'üôÄ', 'üòø', 'üòæ', 'üê±', 'üêà', 'üêà‚Äç‚¨õ', 'ü¶Å', 'üêØ',
                    'üëëüò∫', 'üëëüò∏', 'üëëüòª', 'üëëüôÄ', 'üëëüòø',
                    '‚≠êüò∫', '‚≠êüò∏', '‚≠êüòª', '‚≠êüôÄ', '‚≠êüòø',
                    'üåüüëëüò∫', 'üåüüëëüò∏', 'üåüüëëüòª',
                    'üí´‚≠êüò∫', 'üí´‚≠êüò∏',
                    'üî•üí´‚≠êüò∫',
                    '‚ö°üî•üí´üò∫',
                    'üåà‚ö°üî•üò∫',
                    'üëºüåà‚ö°üò∫',
                    'üöÄüëºüåàüò∫'
                ];

                this.happyMsgs = [
                    '„Åã„Çè„ÅÑ„ÅÑÔºÅ', '„Åô„Å¶„Åç‚ô™', '„Å†„ÅÑ„Åô„ÅçÔºÅ', '„ÇÑ„Å£„Åü„Å≠ÔºÅ', '„Åô„Åî„Éº„ÅÑÔºÅ',
                    '„Åç„ÇÉ„Éº‚ô™', '„Çè„Éº„ÅÑÔºÅ', '„Å∫„Çç„Å∫„Çç', '„ÇÇ„Åµ„ÇÇ„Åµ', '„Å´„ÇÉ„Çì„Å´„ÇÉ„Çì'
                ];

                this.chainMsgs = [
                    'NICE!', 'GREAT!', 'EXCELLENT!', 'AMAZING!', 'INCREDIBLE!',
                    'LEGENDARY!', 'GODLIKE!', 'IMPOSSIBLE!', 'ULTIMATE!', 'DIVINE!'
                ];

                this.titleMsgs = [
                    '„Éã„É£„Éº„É≥ÔºÅ', 'NEKOPON‚ô™', '„Å´„ÇÉ„Çì„Åì„Å†„ÅÑ„Åô„ÅçÔºÅ', '„ÇÇ„Åµ„ÇÇ„Åµ„Äú', '„Åç„ÇÉ„Çè„ÅÑ„ÅÑÔºÅ'
                ];

                this.init();
            }

            init() {
                // ÁîªÈù¢Âõ∫ÂÆö„ÇíÂº∑Âåñ
                this.enforceScreenLock();

                // ÂÇæ„ÅçÊÑüÁü•„ÅÆÂàùÊúüÂåñ
                this.initTiltSensor();

                // ÂÖ®ÁîªÈù¢„Çø„ÉÉ„ÉóÂØæÂøú
                document.body.addEventListener('click', (e) => this.handleBodyClick(e));
                document.body.addEventListener('touchstart', (e) => {
                    e.preventDefault();
                    const touch = e.touches[0];
                    this.handleBodyClick({clientX: touch.clientX, clientY: touch.clientY});
                });

                // „Çø„Ç§„Éà„É´ÂÖ®‰Ωì„ÅÆ„Çø„ÉÉ„Éó
                document.getElementById('titleElement').addEventListener('click', (e) => {
                    e.stopPropagation();
                    this.bounceTitle();
                });

                // „Çø„Ç§„Éà„É´Áå´„ÅÆ„Çø„ÉÉ„Éó
                document.getElementById('leftCat').addEventListener('click', (e) => {
                    e.stopPropagation();
                    this.bounceCat('left');
                });

                document.getElementById('rightCat').addEventListener('click', (e) => {
                    e.stopPropagation();
                    this.bounceCat('right');
                });

                // Èü≥Â£∞ÂàùÊúüÂåñ
                document.addEventListener('click', () => this.initSound(), {once: true});
                document.addEventListener('touchstart', () => this.initSound(), {once: true});

                // „Éè„Éó„ÉÜ„Ç£„ÉÉ„ÇØ„Éï„Ç£„Éº„Éâ„Éê„ÉÉ„ÇØÂØæÂøú
                this.vibrate = (pattern) => {
                    if ('vibrate' in navigator) {
                        navigator.vibrate(pattern);
                    }
                };

                // „Ç≤„Éº„É†„É´„Éº„Éó
                setInterval(() => this.update(), 16);
                this.updateUI();
            }

            enforceScreenLock() {
                // ËøΩÂä†„ÅÆÁîªÈù¢Âõ∫ÂÆöÂØæÁ≠ñ
                document.addEventListener('touchmove', (e) => {
                    e.preventDefault();
                }, { passive: false });

                document.addEventListener('gesturestart', (e) => {
                    e.preventDefault();
                });

                document.addEventListener('gesturechange', (e) => {
                    e.preventDefault();
                });

                document.addEventListener('gestureend', (e) => {
                    e.preventDefault();
                });

                // „ÉÄ„Éñ„É´„Çø„ÉÉ„Éó„Å´„Çà„Çã„Ç∫„Éº„É†Èò≤Ê≠¢
                let lastTouchEnd = 0;
                document.addEventListener('touchend', (e) => {
                    const now = (new Date()).getTime();
                    if (now - lastTouchEnd <= 300) {
                        e.preventDefault();
                    }
                    lastTouchEnd = now;
                }, false);
            }

            initTiltSensor() {
                // iOS 13‰ª•Èôç„ÅÆË®±ÂèØË¶ÅÊ±Ç
                if (typeof DeviceOrientationEvent !== 'undefined' && typeof DeviceOrientationEvent.requestPermission === 'function') {
                    this.showTiltPermissionPopup();
                } else {
                    this.enableTiltSensor();
                }
            }

            showTiltPermissionPopup() {
                const popup = document.createElement('div');
                popup.className = 'permission-popup';
                popup.innerHTML = `
                    <h3>üê± Áå´ÂèçÂøúÊ©üËÉΩ üê±</h3>
                    <p>„Çπ„Éû„Éõ„ÇíÂÇæ„Åë„Çã„Å®Áå´„Åå„ÇØ„É´„ÇØ„É´ÂõûËª¢„Åó„Åæ„Åô‚ô™</p>
                    <button onclick="game.requestTiltPermission()">ÊúâÂäπ„Å´„Åô„Çã</button>
                    <button onclick="game.skipTiltPermission()">„Çπ„Ç≠„ÉÉ„Éó</button>
                `;
                document.body.appendChild(popup);
                this.permissionPopup = popup;
            }

            async requestTiltPermission() {
                try {
                    const permission = await DeviceOrientationEvent.requestPermission();
                    if (permission === 'granted') {
                        this.enableTiltSensor();
                        this.showMsg('Áå´„Åå„ÇØ„É´„ÇØ„É´ÂõûËª¢ÔºÅ', window.innerWidth/2, window.innerHeight/2);
                    }
                } catch (error) {
                    console.log('Permission denied');
                }
                this.closeTiltPermissionPopup();
            }

            skipTiltPermission() {
                this.closeTiltPermissionPopup();
            }

            closeTiltPermissionPopup() {
                if (this.permissionPopup) {
                    this.permissionPopup.remove();
                    this.permissionPopup = null;
                }
            }

            enableTiltSensor() {
                this.tiltEnabled = true;
                window.addEventListener('deviceorientation', (event) => {
                    if (!this.tiltEnabled) return;

                    this.currentTilt.gamma = event.gamma || 0; // Â∑¶Âè≥„ÅÆÂÇæ„Åç (-90 to 90)
                    this.currentTilt.beta = event.beta || 0;   // ÂâçÂæå„ÅÆÂÇæ„Åç (-180 to 180)
                    this.updateCatOrientations();
                });
            }

            updateCatOrientations() {
                const now = Date.now();
                if (now - this.lastTiltTime < 30) return; // 30FPS„Å´Âà∂Èôê
                this.lastTiltTime = now;

                const gamma = this.currentTilt.gamma;
                const beta = this.currentTilt.beta;

                // Â§ßÂπÖ„Å´ÂõûËª¢ËßíÂ∫¶„ÇíÂ¢óÂä†
                let baseRotation = gamma * 2; // 2ÂÄç„ÅÆÂõûËª¢

                // ÈÄÜ„Åï„Åæ„ÅÆÂ†¥Âêà„ÅØ180Â∫¶ËøΩÂä†ÔºàÂà§ÂÆö„ÇíÁ∑©„ÅèÔºâ
                if (Math.abs(beta) > 90) {
                    baseRotation += 180;
                }

                // „Åï„Çâ„Å´Â§ß„Åç„ÅèÂõûËª¢„Åï„Åõ„Çã
                if (Math.abs(gamma) > 30) {
                    baseRotation = gamma * 2.5; // „Çà„ÇäÂ§ß„Åç„Å™ÂõûËª¢
                }

                // ÂÖ®„Å¶„ÅÆÁå´„Å´ÈÅ©Áî®Ôºàpop‰∏≠„Åß„ÇÇÂõûËª¢ÔºÅÔºâ
                this.cats.forEach((cat, index) => {
                    if (cat.element.classList.contains('dragging')) return;

                    // ÂÇæ„ÅçÂõûËª¢„Çí„Åô„Åπ„Å¶„ÅÆÁå´„Å´ÈÅ©Áî®Ôºàpop„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥‰∏≠„ÇÇÂê´„ÇÄÔºâ
                    const individualRotation = baseRotation * 1.3 + (index % 7 - 3) * 20;

                    // „Éû„Éº„Ç∏„Å®„ÉÅ„Çß„Éº„É≥„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥‰∏≠„ÅÆ„ÅøÈô§Â§ñ
                    if (!cat.element.classList.contains('merging') && !cat.element.classList.contains('chain')) {
                        // pop„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥‰∏≠„Åß„ÇÇÂÇæ„ÅçÂõûËª¢„ÇíÈÅ©Áî®
                        if (cat.element.classList.contains('pop')) {
                            // pop„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥„Å®ÂõûËª¢„ÇíÂêàÊàê
                            cat.element.style.transform = `rotate(${individualRotation}deg) scale(1)`;
                        } else {
                            cat.element.style.transform = `rotate(${individualRotation}deg) scale(1)`;
                        }
                    }
                });

                // „Çø„Ç§„Éà„É´„ÅÆÁå´„ÇÇÂ§ß„Åç„ÅèÂõûËª¢Ôºà„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥‰∏≠„ÅØÈô§„ÅèÔºâ
                const titleLeftCat = document.getElementById('leftCat');
                const titleRightCat = document.getElementById('rightCat');

                if (titleLeftCat && titleRightCat && !this.titleBouncing) {
                    // bounce„ÇØ„É©„Çπ„Åå„Å™„ÅÑÊôÇ„ÅÆ„ÅøÂÇæ„ÅçÂõûËª¢ÈÅ©Áî®
                    if (!titleLeftCat.classList.contains('bounce') && !titleRightCat.classList.contains('bounce')) {
                        const titleRotationLeft = baseRotation * 1.2 - 20;
                        const titleRotationRight = baseRotation * 1.2 + 20;
                        titleLeftCat.style.transform = `rotate(${titleRotationLeft}deg) scale(1)`;
                        titleRightCat.style.transform = `rotate(${titleRotationRight}deg) scale(1)`;
                    }
                }
            }

            bounceTitle() {
                const titleElement = document.getElementById('titleElement');
                this.titleBouncing = true;
                titleElement.classList.add('title-bounce');

                // ÁâπÂà•„Å™Èü≥„Åß„Çø„Ç§„Éà„É´Áî®„ÅÆÁâπÂà•ÊÑü„ÇíÊºîÂá∫
                this.playSound('title');
                this.vibrate([120, 60, 120, 60, 180]);

                const rect = titleElement.getBoundingClientRect();
                this.createParticles(rect.left + rect.width/2, rect.top + rect.height/2, ['üí´', '‚ú®', 'üåü', 'üíñ', 'üéä', 'üéÜ', 'üåà'], 8);

                // „Çø„Ç§„Éà„É´„Éú„Éº„Éä„Çπ
                this.score += 50;
                this.showFloatingScore(50, rect.left + rect.width/2, rect.top + rect.height/2);
                this.showMsg(this.titleMsgs[Math.floor(Math.random() * this.titleMsgs.length)], rect.left + rect.width/2, rect.top + rect.height/2);

                setTimeout(() => {
                    titleElement.classList.remove('title-bounce');
                    this.titleBouncing = false;
                }, 1200);

                this.updateUI();
            }

            handleBodyClick(e) {
                // UI„Ç®„É¨„É°„É≥„Éà„Åã„Å©„ÅÜ„Åã„ÉÅ„Çß„ÉÉ„ÇØ
                const target = e.target || document.elementFromPoint(e.clientX, e.clientY);
                if (target && (
                    target.closest('.header') ||
                    target.closest('.title') ||
                    target.closest('.permission-popup')
                )) {
                    return;
                }

                this.spawn(e);
            }

            bounceCat(side) {
                const catId = side === 'left' ? 'leftCat' : 'rightCat';
                const catElement = document.getElementById(catId);

                catElement.classList.add('bounce');
                this.playSound('purr');
                this.vibrate([50]);

                const rect = catElement.getBoundingClientRect();
                this.createParticles(rect.left + rect.width/2, rect.top + rect.height/2, ['üí´', '‚ú®', 'üåü'], 3);

                // „Éú„Éº„Éä„Çπ
                this.score += 10;
                this.showFloatingScore(10, rect.left + rect.width/2, rect.top + rect.height/2);
                this.showMsg('„Å´„ÇÉ„Çì‚ô™', rect.left + rect.width/2, rect.top + rect.height/2);

                setTimeout(() => catElement.classList.remove('bounce'), 800);
                this.updateUI();
            }

            initSound() {
                try {
                    this.audioContext = new (window.AudioContext || window.webkitAudioContext)();
                } catch (e) {
                    console.log('Audio not supported');
                }
            }

            spawn(e) {
                const rect = document.getElementById('field').getBoundingClientRect();
                let x = e.clientX - rect.left;
                let y = e.clientY - rect.top;

                // „Éï„Ç£„Éº„É´„ÉâÂÜÖ„Å´Ë™øÊï¥
                x = Math.max(30, Math.min(rect.width - 30, x));
                y = Math.max(30, Math.min(rect.height - 30, y));

                const level = 0; // Â∏∏„Å´ÊúÄÂàù„ÅÆ„É¨„Éô„É´„Åã„Çâ
                const type = this.evolutionChain[level];

                const cat = {
                    id: this.catId++,
                    x, y, level, type,
                    element: null,
                    birth: Date.now()
                };

                cat.element = this.createElement(cat);
                this.cats.push(cat);

                const basePoints = this.feverMode ? 10 : 5;
                this.score += basePoints;
                this.discovered.add(type);

                this.playSound('spawn');
                this.vibrate([30]);

                this.createParticles(e.clientX, e.clientY, ['‚ú®', 'üåü'], 2);
                this.showFloatingScore(basePoints, e.clientX, e.clientY);
                this.showMsg(this.happyMsgs[Math.floor(Math.random() * this.happyMsgs.length)], e.clientX, e.clientY);

                setTimeout(() => this.checkMerge(), 100);
                this.updateUI();
            }

            createElement(cat) {
                const el = document.createElement('div');
                el.className = 'cat pop';
                el.textContent = cat.type;
                el.style.left = (cat.x - 25) + 'px';
                el.style.top = (cat.y - 25) + 'px';

                // pop„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥ÊôÇÈñì„ÇíÁü≠Á∏ÆÔºà400msÔºâ
                setTimeout(() => el.classList.remove('pop'), 400);

                this.setupDrag(el, cat);
                document.getElementById('field').appendChild(el);
                return el;
            }

            setupDrag(el, cat) {
                let dragging = false;
                let longPress = null;

                const start = (e) => {
                    e.stopPropagation();
                    dragging = true;
                    el.classList.add('dragging');
                    longPress = setTimeout(() => this.pet(cat), 600);
                    e.preventDefault();
                };

                const end = () => {
                    if (dragging) {
                        dragging = false;
                        el.classList.remove('dragging');
                        clearTimeout(longPress);
                        setTimeout(() => this.checkMerge(), 50);
                    }
                };

                const move = (clientX, clientY) => {
                    if (dragging) {
                        clearTimeout(longPress);
                        const rect = document.getElementById('field').getBoundingClientRect();
                        cat.x = Math.max(25, Math.min(rect.width - 25, clientX - rect.left));
                        cat.y = Math.max(25, Math.min(rect.height - 25, clientY - rect.top));
                        el.style.left = (cat.x - 25) + 'px';
                        el.style.top = (cat.y - 25) + 'px';
                    }
                };

                el.addEventListener('mousedown', start);
                document.addEventListener('mouseup', end);
                document.addEventListener('mousemove', (e) => move(e.clientX, e.clientY));

                el.addEventListener('touchstart', start);
                document.addEventListener('touchend', end);
                el.addEventListener('touchmove', (e) => {
                    if (e.touches.length > 0) {
                        const touch = e.touches[0];
                        move(touch.clientX, touch.clientY);
                    }
                });
            }

            pet(cat) {
                cat.element.classList.add('merging');

                const points = this.feverMode ? 20 : 10;
                this.score += points;

                this.playSound('purr');
                this.vibrate([100, 50, 100]);

                const rect = document.getElementById('field').getBoundingClientRect();
                this.showFloatingScore(points, cat.x + rect.left, cat.y + rect.top);
                this.showMsg('üíï', cat.x + rect.left, cat.y + rect.top);
                this.createParticles(cat.x + rect.left, cat.y + rect.top, ['üíñ', 'üíï', 'üíì'], 4);

                setTimeout(() => cat.element.classList.remove('merging'), 800);
                this.updateUI();
            }

            checkMerge() {
                const mergeGroups = new Map();

                // Âêå„Åò„Çø„Ç§„Éó„Åß„Ç∞„É´„Éº„ÉóÂåñ
                for (let i = 0; i < this.cats.length; i++) {
                    const cat = this.cats[i];
                    if (!mergeGroups.has(cat.type)) {
                        mergeGroups.set(cat.type, []);
                    }
                    mergeGroups.get(cat.type).push({cat, index: i});
                }

                // „Éû„Éº„Ç∏Âá¶ÁêÜ
                for (const [type, group] of mergeGroups) {
                    if (group.length >= 2) {
                        // 2Âåπ‰ª•‰∏ä„ÅÑ„Çã„Ç∞„É´„Éº„Éó„ÅßË∑ùÈõ¢„ÉÅ„Çß„ÉÉ„ÇØ
                        for (let i = 0; i < group.length; i++) {
                            for (let j = i + 1; j < group.length; j++) {
                                const a = group[i].cat;
                                const b = group[j].cat;
                                const dist = Math.sqrt((a.x - b.x) ** 2 + (a.y - b.y) ** 2);

                                if (dist < 70) { // Èáç„Å™„Å£„Åü„ÇâÂêà‰Ωì
                                    this.merge([group[i], group[j]]);
                                    return;
                                }
                            }
                        }
                    }

                    // 3Âåπ‰ª•‰∏ä„ÅÆÂ†¥Âêà„ÅØ„Ç≥„É≥„Éú„Éû„Éº„Ç∏„ÉÅ„Çß„ÉÉ„ÇØ
                    if (group.length >= 3) {
                        for (let i = 0; i < group.length; i++) {
                            for (let j = i + 1; j < group.length; j++) {
                                for (let k = j + 1; k < group.length; k++) {
                                    const a = group[i].cat;
                                    const b = group[j].cat;
                                    const c = group[k].cat;

                                    const dist1 = Math.sqrt((a.x - b.x) ** 2 + (a.y - b.y) ** 2);
                                    const dist2 = Math.sqrt((b.x - c.x) ** 2 + (b.y - c.y) ** 2);
                                    const dist3 = Math.sqrt((a.x - c.x) ** 2 + (a.y - c.y) ** 2);

                                    if (dist1 < 90 && dist2 < 90 && dist3 < 90) {
                                        this.comboMerge([group[i], group[j], group[k]]);
                                        return;
                                    }
                                }
                            }
                        }
                    }
                }
            }

            merge(group) {
                // „Éû„Éº„Ç∏„Ç®„Éï„Çß„ÇØ„Éà
                group.forEach(item => {
                    item.cat.element.classList.add('merging');
                });

                setTimeout(() => {
                    // ‰∏≠ÂøÉÁÇπË®àÁÆó
                    const centerX = group.reduce((sum, item) => sum + item.cat.x, 0) / group.length;
                    const centerY = group.reduce((sum, item) => sum + item.cat.y, 0) / group.length;

                    // Âè§„ÅÑ„Éç„Ç≥„ÇíÂâäÈô§
                    const indices = group.map(item => item.index).sort((a, b) => b - a);
                    indices.forEach(index => {
                        this.cats[index].element.remove();
                        this.cats.splice(index, 1);
                    });

                    // Êñ∞„Åó„ÅÑ„Éç„Ç≥ÁîüÊàê
                    const oldLevel = group[0].cat.level;
                    const newLevel = Math.min(this.evolutionChain.length - 1, oldLevel + 1);
                    const newType = this.evolutionChain[newLevel];

                    const newCat = {
                        id: this.catId++,
                        x: centerX,
                        y: centerY,
                        level: newLevel,
                        type: newType,
                        element: null,
                        birth: Date.now()
                    };

                    newCat.element = this.createElement(newCat);
                    this.cats.push(newCat);

                    // „Çπ„Ç≥„Ç¢Ë®àÁÆó
                    const basePoints = Math.pow(2, newLevel + 1) * 10;
                    const points = this.feverMode ? basePoints * 2 : basePoints;
                    this.score += points;
                    this.discovered.add(newType);

                    // „ÉÅ„Çß„Éº„É≥Â¢óÂä†
                    this.chainCount++;
                    this.maxChain = Math.max(this.maxChain, this.chainCount);
                    this.updateChainDisplay();

                    // „Éï„Ç£„Éº„Éê„Éº„É¢„Éº„ÉâÂà§ÂÆö
                    if (this.chainCount >= 3 && !this.feverMode) {
                        this.enterFeverMode();
                    }

                    // „É¨„Éô„É´„Ç¢„ÉÉ„ÉóÂà§ÂÆö
                    if (newLevel > this.level) {
                        this.level = newLevel;
                        this.playSound('levelup');
                        this.vibrate([200, 100, 200]);
                    } else {
                        this.playSound('merge');
                        this.vibrate([100]);
                    }

                    const rect = document.getElementById('field').getBoundingClientRect();
                    this.showFloatingScore(points, centerX + rect.left, centerY + rect.top);
                    this.createMegaExplosion(centerX + rect.left, centerY + rect.top);

                    // ÈÄ£Èéñ„ÉÅ„Çß„ÉÉ„ÇØ
                    setTimeout(() => this.checkMerge(), 200);
                }, 400);

                this.updateUI();
            }

            comboMerge(group) {
                // „Ç≥„É≥„Éú„Ç®„Éï„Çß„ÇØ„Éà
                group.forEach(item => {
                    item.cat.element.classList.add('chain');
                });

                setTimeout(() => {
                    const centerX = group.reduce((sum, item) => sum + item.cat.x, 0) / group.length;
                    const centerY = group.reduce((sum, item) => sum + item.cat.y, 0) / group.length;

                    // Âè§„ÅÑ„Éç„Ç≥„ÇíÂâäÈô§
                    const indices = group.map(item => item.index).sort((a, b) => b - a);
                    indices.forEach(index => {
                        this.cats[index].element.remove();
                        this.cats.splice(index, 1);
                    });

                    // 2„É¨„Éô„É´‰∏ä„ÅÆÊñ∞„Åó„ÅÑ„Éç„Ç≥ÁîüÊàê
                    const oldLevel = group[0].cat.level;
                    const newLevel = Math.min(this.evolutionChain.length - 1, oldLevel + 2);
                    const newType = this.evolutionChain[newLevel];

                    const newCat = {
                        id: this.catId++,
                        x: centerX,
                        y: centerY,
                        level: newLevel,
                        type: newType,
                        element: null,
                        birth: Date.now()
                    };

                    newCat.element = this.createElement(newCat);
                    this.cats.push(newCat);

                    // Â§ßÂπÖ„Éú„Éº„Éä„Çπ
                    const basePoints = Math.pow(2, newLevel + 2) * 25;
                    const points = this.feverMode ? basePoints * 3 : basePoints;
                    this.score += points;
                    this.discovered.add(newType);

                    // „ÉÅ„Çß„Éº„É≥Â§ßÂπÖÂ¢óÂä†
                    this.chainCount += 3;
                    this.maxChain = Math.max(this.maxChain, this.chainCount);
                    this.updateChainDisplay();

                    // Âº∑Âà∂„Éï„Ç£„Éº„Éê„Éº„É¢„Éº„Éâ
                    this.enterFeverMode();

                    if (newLevel > this.level) {
                        this.level = newLevel;
                        this.playSound('levelup');
                        this.vibrate([300, 100, 300, 100, 300]);
                    } else {
                        this.playSound('merge');
                        this.vibrate([200, 50, 200]);
                    }

                    const rect = document.getElementById('field').getBoundingClientRect();
                    this.showFloatingScore(points, centerX + rect.left, centerY + rect.top, 'mega');
                    this.showChainText(centerX + rect.left, centerY + rect.top);
                    this.createUltimateExplosion(centerX + rect.left, centerY + rect.top);

                    setTimeout(() => this.checkMerge(), 300);
                }, 500);

                this.updateUI();
            }

            enterFeverMode() {
                if (this.feverMode) return;

                this.feverMode = true;
                const feverEl = document.createElement('div');
                feverEl.className = 'fever-mode';
                document.body.appendChild(feverEl);
                this.feverElement = feverEl;

                this.playSound('fever');
                this.vibrate([100, 50, 100, 50, 100, 50, 100]);

                clearTimeout(this.feverTimer);
                this.feverTimer = setTimeout(() => {
                    this.exitFeverMode();
                }, 10000); // 10ÁßíÈñì
            }

            exitFeverMode() {
                this.feverMode = false;
                if (this.feverElement) {
                    this.feverElement.remove();
                    this.feverElement = null;
                }
            }

            updateChainDisplay() {
                document.getElementById('chainDisplay').textContent = this.chainCount;
                document.getElementById('chainItem').classList.add('pulse');
                setTimeout(() => {
                    document.getElementById('chainItem').classList.remove('pulse');
                }, 600);

                clearTimeout(this.chainTimer);
                this.chainTimer = setTimeout(() => {
                    this.chainCount = 0;
                    document.getElementById('chainDisplay').textContent = '0';
                    this.exitFeverMode();
                }, 5000);
            }

            showFloatingScore(points, x, y, type = 'normal') {
                const el = document.createElement('div');
                el.className = `floating-score ${type}`;
                el.textContent = `+${this.formatNum(points)}`;
                el.style.left = Math.min(x, window.innerWidth - 100) + 'px';
                el.style.top = Math.min(y, window.innerHeight - 50) + 'px';
                document.body.appendChild(el);
                setTimeout(() => el.remove(), type === 'mega' ? 3000 : 2000);
            }

            showChainText(x, y) {
                const chainLevel = Math.min(this.chainMsgs.length - 1, Math.floor(this.chainCount / 2));
                const text = this.chainMsgs[chainLevel];

                const el = document.createElement('div');
                el.className = 'chain-text';
                el.textContent = text;
                el.style.left = Math.min(x - 100, window.innerWidth - 200) + 'px';
                el.style.top = Math.min(y - 50, window.innerHeight - 100) + 'px';
                document.body.appendChild(el);
                setTimeout(() => el.remove(), 3000);
            }

            createParticles(x, y, emojis, count) {
                for (let i = 0; i < count; i++) {
                    setTimeout(() => {
                        const el = document.createElement('div');
                        el.className = 'particle';
                        el.textContent = emojis[Math.floor(Math.random() * emojis.length)];
                        el.style.left = (x + (Math.random() - 0.5) * 60) + 'px';
                        el.style.top = (y + (Math.random() - 0.5) * 60) + 'px';
                        document.body.appendChild(el);
                        setTimeout(() => el.remove(), 2000);
                    }, i * 50);
                }
            }

            createMegaExplosion(x, y) {
                const effects = ['üí´', '‚ú®', 'üåü', 'üíñ', 'üéä', 'üéÜ'];
                this.createParticles(x, y, effects, 8);
            }

            createUltimateExplosion(x, y) {
                const effects = ['üí•', '‚ú®', 'üåü', 'üí´', 'üéä', 'üéÜ', 'üíñ', 'üåà', '‚ö°', 'üî•'];
                this.createParticles(x, y, effects, 15);
            }

            showMsg(text, x, y) {
                const el = document.createElement('div');
                el.className = 'msg';
                el.textContent = text;
                el.style.left = Math.min(x, window.innerWidth - 80) + 'px';
                el.style.top = Math.min(y, window.innerHeight - 40) + 'px';
                document.body.appendChild(el);
                setTimeout(() => el.remove(), 2500);
            }

            playSound(type) {
                if (!this.audioContext) return;

                try {
                    if (this.audioContext.state === 'suspended') {
                        this.audioContext.resume();
                    }

                    const oscillator = this.audioContext.createOscillator();
                    const gainNode = this.audioContext.createGain();
                    const filterNode = this.audioContext.createBiquadFilter();

                    oscillator.connect(filterNode);
                    filterNode.connect(gainNode);
                    gainNode.connect(this.audioContext.destination);

                    let frequency, duration, filterFreq;

                    switch(type) {
                        case 'spawn':
                            frequency = 600 + Math.random() * 200;
                            duration = 0.3;
                            filterFreq = 1200;
                            break;
                        case 'merge':
                            frequency = 800;
                            duration = 0.6;
                            filterFreq = 2000;
                            break;
                        case 'levelup':
                            frequency = 1200;
                            duration = 1.0;
                            filterFreq = 3000;
                            break;
                        case 'purr':
                            frequency = 300;
                            duration = 1.5;
                            filterFreq = 600;
                            break;
                        case 'fever':
                            frequency = 1500;
                            duration = 2.0;
                            filterFreq = 4000;
                            break;
                        case 'title': // „Çø„Ç§„Éà„É´Â∞ÇÁî®„ÅÆÁâπÂà•„Å™Èü≥
                            frequency = 900;
                            duration = 1.8;
                            filterFreq = 2500;
                            // Ë§áÊï∞„ÅÆÂë®Ê≥¢Êï∞„ÇíÈáç„Å≠„Å¶Ë±™ËèØ„Å™Èü≥„Å´
                            setTimeout(() => {
                                const osc2 = this.audioContext.createOscillator();
                                const gain2 = this.audioContext.createGain();
                                osc2.connect(gain2);
                                gain2.connect(this.audioContext.destination);
                                osc2.frequency.setValueAtTime(1200, this.audioContext.currentTime);
                                gain2.gain.setValueAtTime(0.08, this.audioContext.currentTime);
                                osc2.start();
                                osc2.stop(this.audioContext.currentTime + 1.5);
                            }, 200);
                            break;
                        default:
                            frequency = 440;
                            duration = 0.3;
                            filterFreq = 1000;
                    }

                    oscillator.frequency.setValueAtTime(frequency, this.audioContext.currentTime);

                    if (type === 'title') {
                        // „Çø„Ç§„Éà„É´Èü≥„ÅØË§áÈõë„Å™Èü≥Á®ãÂ§âÂåñ
                        oscillator.frequency.exponentialRampToValueAtTime(frequency * 1.5, this.audioContext.currentTime + duration * 0.3);
                        oscillator.frequency.exponentialRampToValueAtTime(frequency * 0.8, this.audioContext.currentTime + duration);
                    } else {
                        oscillator.frequency.exponentialRampToValueAtTime(frequency * 0.6, this.audioContext.currentTime + duration);
                    }

                    filterNode.frequency.setValueAtTime(filterFreq, this.audioContext.currentTime);
                    filterNode.Q.setValueAtTime(2, this.audioContext.currentTime);

                    gainNode.gain.setValueAtTime(0.15, this.audioContext.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, this.audioContext.currentTime + duration);

                    oscillator.start(this.audioContext.currentTime);
                    oscillator.stop(this.audioContext.currentTime + duration);
                } catch (e) {
                    // Audio error - ignore
                }
            }

            update() {
                // „Ç≤„Éº„É†Áä∂ÊÖãÊõ¥Êñ∞
                this.updateUI();
            }

            updateUI() {
                document.getElementById('score').textContent = this.formatNum(this.score);
                document.getElementById('level').textContent = this.level;

                // „Çπ„Ç≥„Ç¢Â¢óÂä†ÊôÇ„ÅÆ„Éë„É´„ÇπÂäπÊûú
                if (this.lastScore !== this.score) {
                    document.getElementById('scoreItem').classList.add('pulse');
                    setTimeout(() => {
                        document.getElementById('scoreItem').classList.remove('pulse');
                    }, 600);
                    this.lastScore = this.score;
                }
            }

            formatNum(n) {
                if (n >= 1e9) return Math.floor(n / 1e9) + 'B';
                if (n >= 1e6) return Math.floor(n / 1e6) + 'M';
                if (n >= 1e3) return Math.floor(n / 1e3) + 'K';
                return Math.floor(n).toString();
            }
        }

        // „Ç∞„É≠„Éº„Éê„É´Â§âÊï∞„Å®„Åó„Å¶Ë®≠ÂÆöÔºàË®±ÂèØË¶ÅÊ±ÇÁî®Ôºâ
        const game = new UltimateNekopon();
    </script>
</body>
</html>